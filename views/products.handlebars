<div class="container">
<h1>Productos</h1>

<div class="products-grid">
    {{#each products}}
    <div class="product-card">
        <h3>{{this.title}}</h3>
        <p>{{this.description}}</p>
        <p><strong>Precio:</strong> ${{this.price}}</p>
        <p><strong>Stock:</strong> {{this.stock}}</p>
        <p><strong>Categoría:</strong> {{this.category}}</p>
        <div class="product-actions">
        <a href="/products/{{this._id}}" class="btn btn-info">Ver detalles</a>
        <button class="btn btn-primary" onclick="addToCart('{{this._id}}')">
            Agregar al carrito
        </button>
        </div>
    </div>
    {{/each}}
</div>

<!-- Paginación -->
<div class="pagination">
    {{#if hasPrevPage}}
    <a href="{{prevLink}}" class="btn">← Anterior</a>
    {{/if}}
    
    <span>Página {{page}} de {{totalPages}}</span>
    
    {{#if hasNextPage}}
    <a href="{{nextLink}}" class="btn">Siguiente →</a>
    {{/if}}
</div>
</div>

<style>
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.product-card {
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 8px;
    background: white;
}

.product-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.btn {
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    display: inline-block;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-info {
    background: #17a2b8;
    color: white;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
}
</style>

<script>
  // Puedes guardar el cartId en localStorage o crearlo dinámicamente
async function addToCart(productId) {
    try {
      // Obtener o crear carrito
    let cartId = localStorage.getItem('cartId');
    
    if (!cartId) {
        const response = await fetch('/api/carts', { method: 'POST' });
        const cart = await response.json();
        cartId = cart._id;
        localStorage.setItem('cartId', cartId);
    }
    
      // Agregar producto al carrito
    const response = await fetch(`/api/carts/${cartId}/product/${productId}`, {
        method: 'POST'
    });
    
    if (response.ok) {
        alert('Producto agregado al carrito');
    }
    } catch (error) {
    alert('Error al agregar producto');
    }
}
</script>